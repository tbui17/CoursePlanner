FROM node:20-alpine
USER root
RUN npm i npm@latest -g
WORKDIR /opt/node_app
COPY --chown=node:node package.json package-lock.json* ./
RUN npm ci && npm cache clean --force
COPY . .
RUN npm run test